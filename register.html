<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="no-referrer" />
    <title>新規登録 - スタートアップコネクト</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Noto Sans JP", sans-serif;
      }
      .step-active {
        background-color: #2563eb;
        color: white;
      }
      .step-complete {
        background-color: #34d399;
        color: white;
      }
      .step-inactive {
        background-color: #e5e7eb;
        color: #6b7280;
      }
      .progress-bar {
        height: 0.25rem;
      }
      .form-section {
        display: none;
      }
      .form-section.active {
        display: block;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <!-- ナビゲーションバー -->
    <nav class="bg-white shadow-md">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex items-center">
            <div class="flex-shrink-0 flex items-center">
              <a href="index.html">
                <svg
                  class="h-8 w-8 text-blue-600"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
              </a>
              <a href="index.html" class="ml-2 text-xl font-bold text-gray-800"
                >スタートアップコネクト</a
              >
            </div>
          </div>
          <div class="hidden md:flex items-center space-x-4">
            <a
              href="index.html#features"
              class="text-gray-600 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium"
              >特徴</a
            >
            <a
              href="index.html#how-it-works"
              class="text-gray-600 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium"
              >使い方</a
            >
            <a
              href="index.html#pricing"
              class="text-gray-600 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium"
              >料金プラン</a
            >
            <a
              href="index.html#testimonials"
              class="text-gray-600 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium"
              >利用者の声</a
            >
            <a
              href="login.html"
              class="text-gray-600 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium"
              >ログイン</a
            >
          </div>
          <div class="flex md:hidden items-center">
            <button
              type="button"
              class="mobile-menu-button text-gray-500 hover:text-blue-600 focus:outline-none"
            >
              <svg
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"
                />
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- モバイルメニュー -->
      <div class="mobile-menu hidden md:hidden bg-white border-t">
        <a
          href="index.html#features"
          class="block px-4 py-2 text-gray-600 hover:bg-gray-100"
          >特徴</a
        >
        <a
          href="index.html#how-it-works"
          class="block px-4 py-2 text-gray-600 hover:bg-gray-100"
          >使い方</a
        >
        <a
          href="index.html#pricing"
          class="block px-4 py-2 text-gray-600 hover:bg-gray-100"
          >料金プラン</a
        >
        <a
          href="index.html#testimonials"
          class="block px-4 py-2 text-gray-600 hover:bg-gray-100"
          >利用者の声</a
        >
        <a
          href="login.html"
          class="block px-4 py-2 text-gray-600 hover:bg-gray-100"
          >ログイン</a
        >
      </div>
    </nav>

    <!-- メインセクション -->
    <main class="max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:py-12 lg:px-8">
      <div class="bg-white rounded-lg shadow-sm overflow-hidden">
        <div class="px-6 py-8">
          <h1 class="text-2xl font-bold text-gray-900 text-center mb-8">
            スタートアップコネクトに参加する
          </h1>

          <!-- エラーメッセージ表示エリア -->
          <div
            id="error-message"
            class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4"
            role="alert"
          >
            <span class="block sm:inline" id="error-text"></span>
          </div>

          <!-- 進捗バー -->
          <div class="max-w-3xl mx-auto mb-10">
            <div class="flex items-center justify-between mb-2">
              <div class="flex flex-col items-center">
                <div
                  id="step1-indicator"
                  class="step-active w-10 h-10 rounded-full flex items-center justify-center mb-1"
                >
                  1
                </div>
                <div class="text-xs text-center">基本情報</div>
              </div>
              <div class="flex-1 mx-2">
                <div class="progress-bar bg-gray-200">
                  <div
                    id="progress-1-2"
                    class="progress-bar bg-blue-600 w-0 transition-all duration-300"
                  ></div>
                </div>
              </div>
              <div class="flex flex-col items-center">
                <div
                  id="step2-indicator"
                  class="step-inactive w-10 h-10 rounded-full flex items-center justify-center mb-1"
                >
                  2
                </div>
                <div class="text-xs text-center">プロフィール</div>
              </div>
              <div class="flex-1 mx-2">
                <div class="progress-bar bg-gray-200">
                  <div
                    id="progress-2-3"
                    class="progress-bar bg-blue-600 w-0 transition-all duration-300"
                  ></div>
                </div>
              </div>
              <div class="flex flex-col items-center">
                <div
                  id="step3-indicator"
                  class="step-inactive w-10 h-10 rounded-full flex items-center justify-center mb-1"
                >
                  3
                </div>
                <div class="text-xs text-center">起業情報</div>
              </div>
            </div>
          </div>

          <!-- 登録フォーム -->
          <form id="registration-form" class="max-w-2xl mx-auto" novalidate>
            <!-- ステップ1: 基本情報 -->
            <section id="step1" class="form-section active">
              <h2 class="text-xl font-semibold text-gray-800 mb-6">基本情報</h2>

              <div class="mb-6">
                <label
                  for="name"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >氏名 <span class="text-red-600">*</span></label
                >
                <div class="flex space-x-4">
                  <div class="flex-1">
                    <input
                      type="text"
                      id="last_name"
                      name="last_name"
                      class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="姓"
                      required
                    />
                  </div>
                  <div class="flex-1">
                    <input
                      type="text"
                      id="first_name"
                      name="first_name"
                      class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="名"
                      required
                    />
                  </div>
                </div>
              </div>

              <div class="mb-6">
                <label
                  for="email"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >メールアドレス <span class="text-red-600">*</span></label
                >
                <input
                  type="email"
                  id="email"
                  name="email"
                  class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="user@example.com"
                  required
                />
                <p class="mt-1 text-xs text-gray-500">
                  ※ログインや通知の受け取りに使用されます
                </p>
              </div>

              <div class="mb-6">
                <label
                  for="password"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >パスワード <span class="text-red-600">*</span></label
                >
                <input
                  type="password"
                  id="password"
                  name="password"
                  class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="8文字以上の英数字"
                  minlength="8"
                  required
                />
                <p class="mt-1 text-xs text-gray-500">
                  ※8文字以上で、英字・数字を含めてください
                </p>
              </div>

              <div class="mb-6">
                <label
                  for="password_confirm"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >パスワード（確認） <span class="text-red-600">*</span></label
                >
                <input
                  type="password"
                  id="password_confirm"
                  name="password_confirm"
                  class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="8文字以上の英数字"
                  minlength="8"
                  required
                />
              </div>

              <div class="mb-6">
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    id="terms"
                    name="terms"
                    class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    required
                  />
                  <label for="terms" class="ml-2 block text-sm text-gray-700">
                    <a href="#" class="text-blue-600 hover:underline"
                      >利用規約</a
                    >と<a href="#" class="text-blue-600 hover:underline"
                      >プライバシーポリシー</a
                    >に同意します
                  </label>
                </div>
              </div>

              <div class="flex justify-end mt-8">
                <button
                  type="button"
                  onclick="nextStep(1)"
                  class="bg-blue-600 text-white px-6 py-2 rounded-md text-sm font-medium hover:bg-blue-700 transition duration-200"
                >
                  次へ
                </button>
              </div>

              <div class="mt-6">
                <div class="relative">
                  <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-gray-300"></div>
                  </div>
                  <div class="relative flex justify-center text-sm">
                    <span class="px-2 bg-gray-50 text-gray-500">または</span>
                  </div>
                </div>

                <div class="mt-6 grid grid-cols-2 gap-3">
                  <div>
                    <button
                      type="button"
                      id="google-register"
                      class="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                    >
                      <svg class="w-5 h-5" viewBox="0 0 24 24">
                        <path
                          fill="#4285F4"
                          d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                        />
                        <path
                          fill="#34A853"
                          d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                        />
                        <path
                          fill="#FBBC05"
                          d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                        />
                        <path
                          fill="#EA4335"
                          d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                        />
                      </svg>
                      <span class="ml-2">Google</span>
                    </button>
                  </div>

                  <div>
                    <button
                      type="button"
                      id="github-register"
                      class="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                    >
                      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path
                          fill-rule="evenodd"
                          d="M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.921.678 1.856 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0020 10.017C20 4.484 15.522 0 10 0z"
                          clip-rule="evenodd"
                        />
                      </svg>
                      <span class="ml-2">GitHub</span>
                    </button>
                  </div>
                </div>
              </div>
            </section>

            <!-- ステップ2: プロフィール情報 -->
            <section id="step2" class="form-section">
              <h2 class="text-xl font-semibold text-gray-800 mb-6">
                プロフィール情報
              </h2>

              <div class="mb-6">
                <label
                  for="profile_image"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >プロフィール画像</label
                >
                <div class="flex items-center space-x-4">
                  <div
                    id="image-preview"
                    class="h-20 w-20 bg-gray-200 rounded-full overflow-hidden flex items-center justify-center"
                  >
                    <svg
                      class="h-10 w-10 text-gray-400"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                      />
                    </svg>
                  </div>
                  <label
                    class="cursor-pointer bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md text-sm font-medium transition duration-200"
                  >
                    画像をアップロード
                    <input
                      type="file"
                      id="profile_image"
                      name="profile_image"
                      class="hidden"
                      accept="image/*"
                    />
                  </label>
                </div>
              </div>

              <div class="mb-6">
                <label
                  for="location"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >地域 <span class="text-red-600">*</span></label
                >
                <select
                  id="location"
                  name="location"
                  class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  required
                >
                  <option value="">選択してください</option>
                  <option value="hokkaido">北海道</option>
                  <option value="aomori">青森県</option>
                  <option value="iwate">岩手県</option>
                  <option value="miyagi">宮城県</option>
                  <option value="akita">秋田県</option>
                  <option value="yamagata">山形県</option>
                  <option value="fukushima">福島県</option>
                  <option value="ibaraki">茨城県</option>
                  <option value="tochigi">栃木県</option>
                  <option value="gunma">群馬県</option>
                  <option value="saitama">埼玉県</option>
                  <option value="chiba">千葉県</option>
                  <option value="tokyo">東京都</option>
                  <option value="kanagawa">神奈川県</option>
                  <option value="niigata">新潟県</option>
                  <option value="toyama">富山県</option>
                  <option value="ishikawa">石川県</option>
                  <option value="fukui">福井県</option>
                  <option value="yamanashi">山梨県</option>
                  <option value="nagano">長野県</option>
                  <option value="gifu">岐阜県</option>
                  <option value="shizuoka">静岡県</option>
                  <option value="aichi">愛知県</option>
                  <option value="mie">三重県</option>
                  <option value="shiga">滋賀県</option>
                  <option value="kyoto">京都府</option>
                  <option value="osaka">大阪府</option>
                  <option value="hyogo">兵庫県</option>
                  <option value="nara">奈良県</option>
                  <option value="wakayama">和歌山県</option>
                  <option value="tottori">鳥取県</option>
                  <option value="shimane">島根県</option>
                  <option value="okayama">岡山県</option>
                  <option value="hiroshima">広島県</option>
                  <option value="yamaguchi">山口県</option>
                  <option value="tokushima">徳島県</option>
                  <option value="kagawa">香川県</option>
                  <option value="ehime">愛媛県</option>
                  <option value="kochi">高知県</option>
                  <option value="fukuoka">福岡県</option>
                  <option value="saga">佐賀県</option>
                  <option value="nagasaki">長崎県</option>
                  <option value="kumamoto">熊本県</option>
                  <option value="oita">大分県</option>
                  <option value="miyazaki">宮崎県</option>
                  <option value="kagoshima">鹿児島県</option>
                  <option value="okinawa">沖縄県</option>
                </select>
              </div>

              <div class="mb-6">
                <label
                  for="age"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >年齢層 <span class="text-red-600">*</span></label
                >
                <select
                  id="age"
                  name="age"
                  class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  required
                >
                  <option value="">選択してください</option>
                  <option value="10s">10代</option>
                  <option value="20s">20代</option>
                  <option value="30s">30代</option>
                  <option value="40s">40代</option>
                  <option value="50s">50代</option>
                  <option value="60s">60代以上</option>
                </select>
              </div>

              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >スキル・専門分野（複数選択可）
                  <span class="text-red-600">*</span></label
                >
                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="skill_tech"
                      name="skills[]"
                      value="tech"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="skill_tech"
                      class="ml-2 block text-sm text-gray-700"
                      >テクノロジー・IT</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="skill_marketing"
                      name="skills[]"
                      value="marketing"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="skill_marketing"
                      class="ml-2 block text-sm text-gray-700"
                      >マーケティング</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="skill_sales"
                      name="skills[]"
                      value="sales"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="skill_sales"
                      class="ml-2 block text-sm text-gray-700"
                      >営業・セールス</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="skill_finance"
                      name="skills[]"
                      value="finance"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="skill_finance"
                      class="ml-2 block text-sm text-gray-700"
                      >財務・会計</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="skill_design"
                      name="skills[]"
                      value="design"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="skill_design"
                      class="ml-2 block text-sm text-gray-700"
                      >デザイン</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="skill_hr"
                      name="skills[]"
                      value="hr"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="skill_hr"
                      class="ml-2 block text-sm text-gray-700"
                      >人事・組織開発</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="skill_legal"
                      name="skills[]"
                      value="legal"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="skill_legal"
                      class="ml-2 block text-sm text-gray-700"
                      >法務・知財</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="skill_planning"
                      name="skills[]"
                      value="planning"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="skill_planning"
                      class="ml-2 block text-sm text-gray-700"
                      >企画・戦略</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="skill_other"
                      name="skills[]"
                      value="other"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="skill_other"
                      class="ml-2 block text-sm text-gray-700"
                      >その他</label
                    >
                  </div>
                </div>
              </div>

              <div class="mb-6">
                <label
                  for="bio"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >自己紹介 <span class="text-red-600">*</span></label
                >
                <textarea
                  id="bio"
                  name="bio"
                  rows="4"
                  class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="あなたの経歴や強み、スキルセットについて簡潔に記入してください"
                  required
                ></textarea>
                <p class="mt-1 text-xs text-gray-500">※300文字以内</p>
              </div>

              <div class="mb-6">
                <label
                  for="linkedin"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >LinkedInプロフィールURL（任意）</label
                >
                <input
                  type="url"
                  id="linkedin"
                  name="linkedin"
                  class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="https://linkedin.com/in/username"
                />
              </div>

              <div class="flex justify-between mt-8">
                <button
                  type="button"
                  onclick="prevStep(2)"
                  class="border border-gray-300 text-gray-700 px-6 py-2 rounded-md text-sm font-medium hover:bg-gray-100 transition duration-200"
                >
                  戻る
                </button>
                <button
                  type="button"
                  onclick="nextStep(2)"
                  class="bg-blue-600 text-white px-6 py-2 rounded-md text-sm font-medium hover:bg-blue-700 transition duration-200"
                >
                  次へ
                </button>
              </div>
            </section>

            <!-- ステップ3: 起業情報 -->
            <section id="step3" class="form-section">
              <h2 class="text-xl font-semibold text-gray-800 mb-6">
                起業に関する情報
              </h2>

              <div class="mb-6">
                <label
                  for="startup_status"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >現在の起業ステータス
                  <span class="text-red-600">*</span></label
                >
                <select
                  id="startup_status"
                  name="startup_status"
                  class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  required
                >
                  <option value="">選択してください</option>
                  <option value="idea">アイデア構想中</option>
                  <option value="planning">事業計画作成中</option>
                  <option value="prototype">プロトタイプ開発中</option>
                  <option value="mvp">MVPローンチ済み</option>
                  <option value="growth">成長フェーズ</option>
                  <option value="partner">パートナー探し中</option>
                  <option value="investor">投資家探し中</option>
                </select>
              </div>

              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >興味のある業界分野（複数選択可）
                  <span class="text-red-600">*</span></label
                >
                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="industry_fintech"
                      name="industries[]"
                      value="fintech"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="industry_fintech"
                      class="ml-2 block text-sm text-gray-700"
                      >Fintech</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="industry_healthtech"
                      name="industries[]"
                      value="healthtech"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="industry_healthtech"
                      class="ml-2 block text-sm text-gray-700"
                      >Healthtech</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="industry_edtech"
                      name="industries[]"
                      value="edtech"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="industry_edtech"
                      class="ml-2 block text-sm text-gray-700"
                      >Edtech</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="industry_ecommerce"
                      name="industries[]"
                      value="ecommerce"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="industry_ecommerce"
                      class="ml-2 block text-sm text-gray-700"
                      >Eコマース</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="industry_ai"
                      name="industries[]"
                      value="ai"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="industry_ai"
                      class="ml-2 block text-sm text-gray-700"
                      >AI・機械学習</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="industry_saas"
                      name="industries[]"
                      value="saas"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="industry_saas"
                      class="ml-2 block text-sm text-gray-700"
                      >SaaS</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="industry_iot"
                      name="industries[]"
                      value="iot"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="industry_iot"
                      class="ml-2 block text-sm text-gray-700"
                      >IoT・ハードウェア</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="industry_cleantech"
                      name="industries[]"
                      value="cleantech"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="industry_cleantech"
                      class="ml-2 block text-sm text-gray-700"
                      >環境・クリーンテック</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="industry_other"
                      name="industries[]"
                      value="other"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="industry_other"
                      class="ml-2 block text-sm text-gray-700"
                      >その他</label
                    >
                  </div>
                </div>
              </div>

              <div class="mb-6">
                <label
                  for="business_idea"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >ビジネスアイデアの概要（任意）</label
                >
                <textarea
                  id="business_idea"
                  name="business_idea"
                  rows="4"
                  class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="現在検討中のビジネスアイデアがあれば、簡潔に記入してください。共有したくない場合は空欄でも構いません。"
                ></textarea>
                <p class="mt-1 text-xs text-gray-500">※500文字以内</p>
              </div>

              <div class="mb-6">
                <label
                  for="looking_for"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >探しているパートナー・スキル
                  <span class="text-red-600">*</span></label
                >
                <textarea
                  id="looking_for"
                  name="looking_for"
                  rows="3"
                  class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="どのようなスキルや経験を持つパートナーを探しているか記入してください"
                  required
                ></textarea>
                <p class="mt-1 text-xs text-gray-500">※200文字以内</p>
              </div>

              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >現在の課題（複数選択可）
                  <span class="text-red-600">*</span></label
                >
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="challenge_cofounder"
                      name="challenges[]"
                      value="cofounder"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="challenge_cofounder"
                      class="ml-2 block text-sm text-gray-700"
                      >共同創業者を探している</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="challenge_funding"
                      name="challenges[]"
                      value="funding"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="challenge_funding"
                      class="ml-2 block text-sm text-gray-700"
                      >資金調達が必要</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="challenge_technical"
                      name="challenges[]"
                      value="technical"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="challenge_technical"
                      class="ml-2 block text-sm text-gray-700"
                      >技術的な課題がある</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="challenge_marketing"
                      name="challenges[]"
                      value="marketing"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="challenge_marketing"
                      class="ml-2 block text-sm text-gray-700"
                      >マーケティング戦略の立案</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="challenge_bizmodel"
                      name="challenges[]"
                      value="bizmodel"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="challenge_bizmodel"
                      class="ml-2 block text-sm text-gray-700"
                      >ビジネスモデルの構築</label
                    >
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="challenge_network"
                      name="challenges[]"
                      value="network"
                      class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                    />
                    <label
                      for="challenge_network"
                      class="ml-2 block text-sm text-gray-700"
                      >人脈・ネットワークの拡大</label
                    >
                  </div>
                </div>
              </div>

              <div class="flex justify-between mt-8">
                <button
                  type="button"
                  onclick="prevStep(3)"
                  class="border border-gray-300 text-gray-700 px-6 py-2 rounded-md text-sm font-medium hover:bg-gray-100 transition duration-200"
                >
                  戻る
                </button>
                <button
                  type="submit"
                  id="submit-button"
                  class="bg-blue-600 text-white px-6 py-2 rounded-md text-sm font-medium hover:bg-blue-700 transition duration-200"
                >
                  登録を完了
                </button>
              </div>
            </section>
          </form>
        </div>

        <div class="px-6 py-4 bg-gray-50 border-t border-gray-200">
          <p class="text-center text-sm text-gray-600">
            すでにアカウントをお持ちですか？
            <a href="login.html" class="text-blue-600 hover:underline"
              >ログイン</a
            >
          </p>
        </div>
      </div>
    </main>

    <!-- フッター -->
    <footer class="bg-gray-100 py-6 mt-12">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center text-gray-500 text-sm">
          <p>&copy; 2024 スタートアップコネクト. All rights reserved.</p>
          <div class="mt-2 space-x-4">
            <a href="#" class="text-gray-500 hover:text-gray-700">利用規約</a>
            <a href="#" class="text-gray-500 hover:text-gray-700"
              >プライバシーポリシー</a
            >
            <a href="#" class="text-gray-500 hover:text-gray-700"
              >お問い合わせ</a
            >
          </div>
        </div>
      </div>
    </footer>

    <script>
      const { SUPABASE_URL, SUPABASE_ANON_KEY } = window.__ENV__;
      const supabase = window.supabase.createClient(
        SUPABASE_URL,
        SUPABASE_ANON_KEY
      );
      if (
        SUPABASE_URL === 'https://example.supabase.co' ||
        SUPABASE_ANON_KEY === 'anon'
      ) {
        alert(
          'config.js is not configured. Set environment variables and run `npm run build`.'
        );
      }

      // グローバル変数
      let currentStep = 1;
      let profileImageFile = null;
      let userId = null;

      // モバイルメニューの表示/非表示
      document
        .querySelector(".mobile-menu-button")
        .addEventListener("click", function () {
          document.querySelector(".mobile-menu").classList.toggle("hidden");
        });

      // エラーメッセージを表示
      function showError(message) {
        const errorDiv = document.getElementById("error-message");
        const errorText = document.getElementById("error-text");
        errorText.textContent = message;
        errorDiv.classList.remove("hidden");
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      // エラーメッセージを非表示
      function hideError() {
        document.getElementById("error-message").classList.add("hidden");
      }

      // ステップ間の移動処理
      function nextStep(currentStepNumber) {
        hideError();
        if (validateStep(currentStepNumber)) {
          if (currentStepNumber === 1) {
            // ステップ1の場合、アカウント作成を実行
            createAccount();
          } else {
            moveToStep(currentStepNumber + 1);
          }
        }
      }

      function prevStep(currentStepNumber) {
        hideError();
        moveToStep(currentStepNumber - 1);
      }

      function moveToStep(stepNumber) {
        // 現在のステップを非表示
        document
          .getElementById("step" + currentStep)
          .classList.remove("active");

        // 次のステップを表示
        document.getElementById("step" + stepNumber).classList.add("active");

        // ステップインジケーターの更新
        updateStepIndicators(stepNumber);

        // プログレスバーの更新
        updateProgressBars(stepNumber);

        currentStep = stepNumber;

        // ページトップにスクロール
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function updateStepIndicators(stepNumber) {
        for (let i = 1; i <= 3; i++) {
          const indicator = document.getElementById("step" + i + "-indicator");
          if (i < stepNumber) {
            indicator.classList.remove("step-active", "step-inactive");
            indicator.classList.add("step-complete");
          } else if (i === stepNumber) {
            indicator.classList.remove("step-complete", "step-inactive");
            indicator.classList.add("step-active");
          } else {
            indicator.classList.remove("step-complete", "step-active");
            indicator.classList.add("step-inactive");
          }
        }
      }

      function updateProgressBars(stepNumber) {
        if (stepNumber >= 2) {
          document.getElementById("progress-1-2").style.width = "100%";
        } else {
          document.getElementById("progress-1-2").style.width = "0%";
        }

        if (stepNumber >= 3) {
          document.getElementById("progress-2-3").style.width = "100%";
        } else {
          document.getElementById("progress-2-3").style.width = "0%";
        }
      }

      // 各ステップのバリデーション
      function validateStep(step) {
        let isValid = true;

        if (step === 1) {
          // ステップ1のバリデーション
          const requiredFields = [
            "last_name",
            "first_name",
            "email",
            "password",
            "password_confirm",
            "terms",
          ];

          requiredFields.forEach((field) => {
            const element = document.getElementById(field);

            if (field === "terms") {
              if (!element.checked) {
                element.classList.add("ring-2", "ring-red-500");
                isValid = false;
              } else {
                element.classList.remove("ring-2", "ring-red-500");
              }
            } else {
              if (!element.value.trim()) {
                element.classList.add("border-red-500");
                isValid = false;
              } else {
                element.classList.remove("border-red-500");
              }
            }
          });

          // パスワード一致確認
          const password = document.getElementById("password").value;
          const passwordConfirm =
            document.getElementById("password_confirm").value;

          if (password !== passwordConfirm) {
            document
              .getElementById("password_confirm")
              .classList.add("border-red-500");
            showError("パスワードが一致しません。");
            isValid = false;
          }

          // パスワード強度チェック
          if (password.length < 8) {
            showError("パスワードは8文字以上で入力してください。");
            isValid = false;
          }

          // メールアドレスの簡易バリデーション
          const email = document.getElementById("email").value;
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (email && !emailRegex.test(email)) {
            document.getElementById("email").classList.add("border-red-500");
            showError("有効なメールアドレスを入力してください。");
            isValid = false;
          }
        } else if (step === 2) {
          // ステップ2のバリデーション
          const requiredFields = ["location", "age", "bio"];

          requiredFields.forEach((field) => {
            const element = document.getElementById(field);
            if (!element.value.trim()) {
              element.classList.add("border-red-500");
              isValid = false;
            } else {
              element.classList.remove("border-red-500");
            }
          });

          // スキルのバリデーション
          const skills = document.querySelectorAll(
            'input[name="skills[]"]:checked'
          );
          if (skills.length === 0) {
            showError("少なくとも1つのスキル・専門分野を選択してください。");
            isValid = false;
          }

          // 自己紹介の文字数チェック
          const bio = document.getElementById("bio").value;
          if (bio.length > 300) {
            showError("自己紹介は300文字以内で入力してください。");
            isValid = false;
          }
        }

        if (!isValid && step === 1) {
          showError("必須項目をすべて入力してください。");
        } else if (!isValid && step === 2) {
          showError("必須項目をすべて入力してください。");
        }

        return isValid;
      }

      // アカウント作成
      async function createAccount() {
        const email = document.getElementById("email").value;
        const passwordField = document.getElementById("password");
        const password = passwordField ? passwordField.value : null;
        const lastName = document.getElementById("last_name").value;
        const firstName = document.getElementById("first_name").value;

        try {
          const {
            data: { user },
          } = await supabase.auth.getUser();

          if (user && !password) {
            // OAuthでログイン済み
            userId = user.id;
            moveToStep(2);
            return;
          }

          // Supabaseでアカウント作成
          const { data, error } = await supabase.auth.signUp({
            email: email,
            password: password,
            options: {
              data: {
                first_name: firstName,
                last_name: lastName,
              },
            },
          });

          if (error) {
            console.error("Signup error:", error);
            if (error.message.includes("already registered")) {
              showError("このメールアドレスは既に登録されています。");
            } else {
              showError("アカウント作成に失敗しました: " + error.message);
            }
          } else {
            userId = data.user.id;
            moveToStep(2);
          }
        } catch (error) {
          console.error("Unexpected error:", error);
          showError("予期しないエラーが発生しました。");
        }
      }

      // プロフィール画像のプレビュー
      document
        .getElementById("profile_image")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            if (file.size > 5 * 1024 * 1024) {
              // 5MB制限
              showError("画像ファイルは5MB以下にしてください。");
              e.target.value = "";
              return;
            }

            profileImageFile = file;
            const reader = new FileReader();
            reader.onload = function (e) {
              const previewContainer = document.getElementById("image-preview");
              previewContainer.innerHTML = "";

              const img = document.createElement("img");
              img.src = e.target.result;
              img.className = "h-full w-full object-cover";
              previewContainer.appendChild(img);
            };
            reader.readAsDataURL(file);
          }
        });

      // OAuth サインアップ
      document
        .getElementById("google-register")
        .addEventListener("click", async () => {
          try {
            const { data, error } = await supabase.auth.signInWithOAuth({
              provider: "google",
              options: {
                redirectTo: window.location.origin + "/register.html?step=2",
              },
            });

            if (error) {
              console.error("Google signup error:", error);
              showError("Googleログインに失敗しました。");
            }
          } catch (error) {
            console.error("Unexpected error:", error);
            showError("予期しないエラーが発生しました。");
          }
        });

      document
        .getElementById("github-register")
        .addEventListener("click", async () => {
          try {
            const { data, error } = await supabase.auth.signInWithOAuth({
              provider: "github",
              options: {
                redirectTo: window.location.origin + "/register.html?step=2",
              },
            });

            if (error) {
              console.error("GitHub signup error:", error);
              showError("GitHubログインに失敗しました。");
            }
          } catch (error) {
            console.error("Unexpected error:", error);
            showError("予期しないエラーが発生しました。");
          }
        });

      // フォーム送信処理
      document
        .getElementById("registration-form")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          // ステップ3のバリデーション
          const requiredFields = ["startup_status", "looking_for"];
          let isValid = true;

          requiredFields.forEach((field) => {
            const element = document.getElementById(field);
            if (!element.value.trim()) {
              element.classList.add("border-red-500");
              isValid = false;
            } else {
              element.classList.remove("border-red-500");
            }
          });

          // 業界分野のバリデーション
          const industries = document.querySelectorAll(
            'input[name="industries[]"]:checked'
          );
          if (industries.length === 0) {
            showError("少なくとも1つの興味のある業界分野を選択してください。");
            isValid = false;
          }

          // 課題のバリデーション
          const challenges = document.querySelectorAll(
            'input[name="challenges[]"]:checked'
          );
          if (challenges.length === 0) {
            showError("少なくとも1つの現在の課題を選択してください。");
            isValid = false;
          }

          if (!isValid) {
            showError("必須項目をすべて入力してください。");
            return;
          }

          // 送信ボタンを無効化
          const submitButton = document.getElementById("submit-button");
          submitButton.disabled = true;
          submitButton.textContent = "登録中...";

          try {
            // 現在のユーザーを取得
            const {
              data: { user },
            } = await supabase.auth.getUser();
            if (!user) {
              showError("セッションが切れました。もう一度お試しください。");
              window.location.href = "register.html";
              return;
            }

            // プロフィール画像のアップロード
            let profileImageUrl = null;
            if (profileImageFile) {
              const fileExt = profileImageFile.name.split(".").pop();
              const fileName = `${user.id}_${Date.now()}.${fileExt}`;
              const filePath = `${user.id}/${fileName}`;

              const { error: uploadError } = await supabase.storage
                .from("profile-images")
                .upload(filePath, profileImageFile);

              if (uploadError) {
                console.error("Upload error:", uploadError);
                showError("プロフィール画像のアップロードに失敗しました。");
              } else {
                const { data } = supabase.storage
                  .from("profile-images")
                  .getPublicUrl(filePath);
                profileImageUrl = data.publicUrl;
              }
            }

            // スキルの収集
            const skills = Array.from(
              document.querySelectorAll('input[name="skills[]"]:checked')
            ).map((cb) => cb.value);

            // 業界の収集
            const industriesArray = Array.from(
              document.querySelectorAll('input[name="industries[]"]:checked')
            ).map((cb) => cb.value);

            // 課題の収集
            const challengesArray = Array.from(
              document.querySelectorAll('input[name="challenges[]"]:checked')
            ).map((cb) => cb.value);

            // プロフィール情報の更新
            const { error: profileError } = await supabase
              .from("profiles")
              .update({
                first_name: document.getElementById("first_name").value,
                last_name: document.getElementById("last_name").value,
                location: document.getElementById("location").value,
                age_range: document.getElementById("age").value,
                bio: document.getElementById("bio").value,
                linkedin_url: document.getElementById("linkedin").value || null,
                profile_image_url: profileImageUrl,
                skills: skills,
              })
              .eq("id", user.id);

            if (profileError) {
              console.error("Profile update error:", profileError);
              showError("プロフィール情報の保存に失敗しました。");
              return;
            }

            // 起業情報の保存
            const { error: startupError } = await supabase
              .from("startup_info")
              .insert({
                user_id: user.id,
                startup_status: document.getElementById("startup_status").value,
                industries: industriesArray,
                business_idea:
                  document.getElementById("business_idea").value || null,
                looking_for: document.getElementById("looking_for").value,
                challenges: challengesArray,
              });

            if (startupError) {
              console.error("Startup info error:", startupError);
              showError("起業情報の保存に失敗しました。");
              return;
            }

            // プロフィール埋め込みの計算
            const profileText = [
              document.getElementById("bio").value,
              skills.join(" "),
              industriesArray.join(" "),
              document.getElementById("looking_for").value,
            ].join(" ");
            try {
              await fetch("/api/compute_embedding", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  user_id: user.id,
                  profile_text: profileText,
                }),
              });
            } catch (e) {
              console.error("embedding", e);
            }

            // 登録完了後、ログインページへリダイレクト
            window.location.href = "login.html?message=registered";
          } catch (error) {
            console.error("Unexpected error:", error);
            showError("予期しないエラーが発生しました。");
          } finally {
            submitButton.disabled = false;
            submitButton.textContent = "登録を完了";
          }
        });

      // 既存のユーザーの続き処理
      window.addEventListener("load", async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const step = urlParams.get("step");

        if (step === "2") {
          // ログインユーザーがステップ2から開始
          const {
            data: { user },
          } = await supabase.auth.getUser();
          if (user) {
            userId = user.id;
            moveToStep(2);
          } else {
            window.location.href = "login.html";
          }
        }
      });
    </script>
  </body>
</html>
